---
output: 
  html_document:
    css: !expr here::here("www", "style.css")
#runtime: shiny

pagetitle: "..."
---

```{r include=FALSE, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
knitr::opts_chunk$set(
  comment = "#>", echo = FALSE, fig.width = 6
)
```


```{r load libraries, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
library(shiny)
library(downloadthis)
library(viridis)
library(tidyverse)
library(gt)
library(readr)
library(knitr)
library(here)
library(DT)
library(scales)
```


```{r}
#Define Functions
mkd_table <- function(err_data, title, subtitle) {
  {{err_data}}
  gt(err_data) %>%
  tab_header(
    title = md(title),
    subtitle = paste("Error Message: ", subtitle)
    ) %>%
  tab_options(
    heading.subtitle.font.size = 12,
    heading.align = "left",
    table.border.top.color = "white",
    column_labels.border.bottom.color = "black",
    table.align = "left",
    table.width = pct(100)
  )
  }
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
source(here::here('rscript', 'student_checks.R'))

```

## Student - Audit Reports {.tabset}

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
list_download <- list(error_check_01, 
     error_check_02, 
     error_check_03, 
     error_check_04, 
     error_check_05, 
     error_check_06,
     error_check_07, 
     error_check_08,
     error_check_09, 
     error_check_10, 
     programs_check_01, 
     programs_check_02,
     stype_check_01,
     stype_check_02,
     stype_check_03,
     stype_check_04,
     stype_check_05,
     stype_check_06,
     stype_check_07,
     stype_check_08,
     stype_check_09,
     stype_check_10,
     stype_check_11,
     stype_check_12,
     stype_check_13,
     stype_check_14,
     stype_check_15
     ) %>%
  download_this(
    output_name = "audit_demographics",
    output_extension = ".xlsx",
    button_label = "Download",
    button_type = "primary",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```


### Demographics

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(error_check_01) > 0) {
  mkd_table(error_check_01, "Gender", unique(error_check_01$error_message)) %>%
    cols_label(term = md("**Term**"),
             pidm = md("**PIDM**"),
             banner_id = md("**Student ID**"),
             first_name = md("**First Name**"),
             last_name = md("**Last Name**"),
             gender = md("**Gender**"),
             error_message = md("**Error Message**"),
             banner_table = md("**Table Name(s)**"),
             banner_column = md("**Column Name(s)**")
             ) %>%
    cols_hide(error_message) %>%
    br()
}
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(error_check_02) > 0) {
mkd_table(error_check_02, "County - US", unique(error_check_02$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               admit_country = md("**Country**"),
               admit_county = md("**County**"),
               error_message = md("**Error Message**"),
               banner_table = md("**Table Name(s)**"),
               banner_column = md("**Column Name(s)**")
               ) %>%
    cols_hide(error_message) %>%
    br()
}
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(error_check_03) > 0) {
mkd_table(error_check_03, "State", unique(error_check_03$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               admit_state = md("**State**"),
               error_message = md("**Error Message**"),
               banner_table = md("**Table Name(s)**"),
               banner_column = md("**Column Name(s)**")
               ) %>%
    cols_hide(error_message) %>%
    br()
}
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(error_check_04) > 0) {
  mkd_table(error_check_04, "County - Utah", unique(error_check_04$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               admit_state = md("**State**"),
               admit_county = md("**County**"),
               error_message = md("**Error Message**"),
               banner_table = md("**Table Name(s)**"),
               banner_column = md("**Column Name(s)**")
               ) %>%
    cols_hide(error_message) %>%
    br()
    }
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(error_check_05) > 0) {
  mkd_table(error_check_05, "Missing Country", unique(error_check_05$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               admit_state = md("**State**"),
               error_message = md("**Error Message**"),
               banner_table = md("**Table Name(s)**"),
               banner_column = md("**Column Name(s)**")
               ) %>%
    cols_hide(error_message) %>%
    br()
    }
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE, fig.align='left'}
if(nrow(error_check_07) > 0) {
  mkd_table(error_check_07, "High School Code", unique(error_check_07$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               age = md("**Age Code**"),
               high_school_code = md("**HS Code**"),
               error_message = md("**Error Message**"),
               banner_table = md("**Table Name(s)**"),
               banner_column = md("**Column Name(s)**")
               ) %>%
    cols_hide(error_message) %>%
  br()
}
```
### International Students
```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(error_check_06) > 0) {
mkd_table(error_check_06, "Visa Type & Citizenship Code", unique(error_check_06$error_message)) %>%
      cols_label(term = md("**Term**"),
                 pidm = md("**PIDM**"),
                 banner_id = md("**Student ID**"),
                 first_name = md("**First Name**"),
                 last_name = md("**Last Name**"),
                 citz_code = md("**Citizen Code**"),
                 visa_type = md("**Visa Type**"),
                 error_message = md("**Error Message**"),
                 banner_table = md("**Table Name(s)**"),
                 banner_column = md("**Column Name(s)**")
                 ) %>%
      cols_hide(error_message) %>%
      br()
      }
```



### Degrees & Programs
```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE, fig.align='left'}
if(nrow(programs_check_01) > 0) {
  mkd_table(programs_check_01, "High School Code", unique(programs_check_01$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               entry_action = md("**Entry Action**"),
               cur_prgm = md("**Program**"),
               high_school_grad_date = md("**HS Graduation Date**"),
               error_message = md("**Error Message**"),
               banner_table = md("**Table Name(s)**"),
               banner_column = md("**Column Name(s)**")
               ) %>%
    cols_hide(error_message) %>%
    br()
    }
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE, fig.align='left'}
if(nrow(programs_check_02) > 0) {
  mkd_table(programs_check_02, "High School Code", unique(programs_check_02$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               degree = md("**Degree**"),
               major_code = md("**Major Code**"),
               cur_prgm = md("**Program**"),
               error_message = md("**Error Message**"),
               banner_table = md("**Table Name(s)**"),
               banner_column = md("**Column Name(s)**")
               ) %>%
    cols_hide(error_message) %>%
  br()
}
```

### Student Type
```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(stype_check_01) > 0) {
  mkd_table(stype_check_01, "Returning Students", unique(stype_check_01$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               entry_action = md("**Entry Action**"),
               first_term_enrolled = md("**First Term Enrolled**"),
               high_school_grad_date = md("**HS Graduation Date**"),
               error_message = md("**Error Message**")
               ) %>%
    cols_hide(error_message) %>%
  br()
}
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(stype_check_02) > 0) {
  mkd_table(stype_check_02, "High School Concurrent Student", unique(stype_check_02$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               term_start_date = md("**Term Start Date**"),
               high_school_grad_date = md("**HS Graduation Date**"),
               student_type = md("**Student Type**"),
               error_message = md("**Error Message**")
               ) %>%
    cols_hide(error_message) %>%
  br()
}
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(stype_check_03) > 0) {
  mkd_table(stype_check_03, "High School Concurrent Student & Program", unique(stype_check_03$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               cur_prgm = md("**Program**"),
               student_type = md("**Student Type**"),
               entry_action = md("**Entry Action**"),
               error_message = md("**Error Message**")
               ) %>%
    cols_hide(error_message) %>%
  br()
}
```

```{r, message = FALSE, warning=FALSE, error = FALSE, echo = FALSE}
if(nrow(stype_check_04) > 0) {
  mkd_table(stype_check_04, "Personal Interest Student", unique(stype_check_04$error_message)) %>%
    cols_label(term = md("**Term**"),
               pidm = md("**PIDM**"),
               banner_id = md("**Student ID**"),
               first_name = md("**First Name**"),
               last_name = md("**Last Name**"),
               cur_prgm = md("**Program**"),
               student_type = md("**Student Type**"),
               entry_action = md("**Entry Action**"),
               error_message = md("**Error Message**")
               ) %>%
    cols_hide(error_message) %>%
  br()
}
```

```{r}
mkd_table(stype_check_04, "Personal Interest Student", "Subtitle")
mkd_table(stype_check_05, "Graduate Students", "Subtitle")
mkd_table(stype_check_06, "", "Subtitle")
mkd_table(stype_check_07, "", "Subtitle")
mkd_table(stype_check_08, "", "Subtitle")
mkd_table(stype_check_09, "", "Subtitle")
mkd_table(stype_check_10, "", "Subtitle")
mkd_table(stype_check_11, "", "Subtitle")
mkd_table(stype_check_12, "", "Subtitle")
mkd_table(stype_check_13, "", "Subtitle")
mkd_table(stype_check_14, "", "Subtitle")
mkd_table(stype_check_15, "", "Subtitle")
```

### Courses
